<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchBot - MayaLogic Interactive Demo</title>
    <meta name="description" content="Interactive voice-first demo for MayaLogic assistant">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --accent: #06b6d4;
            --bg: #0f172a;
            --card: #1e293b;
            --card-border: #334155;
            --text: #f8fafc;
            --muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .back-link {
            color: var(--muted);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--primary); }
        .lang-toggle {
            background: var(--card);
            border: 1px solid var(--card-border);
            color: var(--muted);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .lang-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: var(--muted); font-size: 1rem; }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .mode-tab {
            padding: 0.6rem 1.25rem;
            border: 2px solid var(--card-border);
            background: var(--card);
            color: var(--muted);
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .mode-tab:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .mode-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Personalization Bar */
        .personalization {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .personalization label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .personalization input, .personalization select {
            background: var(--bg);
            border: 1px solid var(--card-border);
            color: var(--text);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            width: 140px;
        }
        .personalization input:focus, .personalization select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .field-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        /* Chat Area */
        .chat-area {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
        }
        .message.maya { flex-direction: row; }
        .message.user { flex-direction: row-reverse; }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .maya .avatar { background: linear-gradient(135deg, var(--primary), var(--accent)); }
        .user .avatar { background: var(--card-border); }
        .bubble {
            max-width: 75%;
            padding: 0.875rem 1.25rem;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .maya .bubble {
            background: var(--bg);
            border-radius: 16px 16px 16px 4px;
        }
        .user .bubble {
            background: var(--primary);
            color: white;
            border-radius: 16px 16px 4px 16px;
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .text-input {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--card-border);
            color: var(--text);
            padding: 0.875rem 1rem;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
        }
        .text-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .text-input::placeholder { color: var(--muted); }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: var(--card);
            color: var(--muted);
            border: 1px solid var(--card-border);
        }
        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        .btn-mic {
            background: var(--success);
            color: white;
            width: 48px;
            padding: 0;
            justify-content: center;
        }
        .btn-mic.listening {
            background: var(--danger);
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        .quick-btn {
            padding: 0.5rem 1rem;
            background: var(--bg);
            border: 1px solid var(--card-border);
            color: var(--muted);
            border-radius: 50px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .quick-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Invoice Display */
        .invoice-preview {
            background: var(--bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1.25rem;
            margin-top: 1rem;
        }
        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--card-border);
        }
        .invoice-title {
            font-weight: 600;
            color: var(--accent);
        }
        .invoice-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }
        .invoice-row.total {
            border-top: 2px solid var(--primary);
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-weight: 700;
            color: var(--success);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--muted);
            font-size: 0.875rem;
        }
        footer a {
            color: var(--primary);
            text-decoration: none;
        }
        footer a:hover { text-decoration: underline; }

        /* Mobile */
        @media (max-width: 640px) {
            h1 { font-size: 2rem; }
            .container { padding: 1rem; }
            .personalization { flex-direction: column; align-items: stretch; }
            .field-group { width: 100%; }
            .personalization input, .personalization select { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <a href="../" class="back-link" id="backLink">‚Üê Back to MayaLogic</a>
                <button class="lang-toggle" id="langToggle">EN</button>
            </div>
            <h1>PitchBot</h1>
            <p class="subtitle" id="subtitleText">Interactive Voice Demo</p>
        </header>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="pitch" id="tabPitch">Pitch</button>
            <button class="mode-tab" data-mode="invoice" id="tabInvoice">Invoice Demo</button>
            <button class="mode-tab" data-mode="qa" id="tabQA">Q&amp;A</button>
        </div>

        <!-- Personalization -->
        <div class="personalization">
            <div class="field-group">
                <label id="labelName">Your Name</label>
                <input type="text" id="userName" placeholder="John">
            </div>
            <div class="field-group">
                <label id="labelBusiness">Business</label>
                <input type="text" id="userBusiness" placeholder="ABC Plumbing">
            </div>
            <div class="field-group">
                <label id="labelTrade">Trade</label>
                <select id="userTrade">
                    <option value="general">General</option>
                    <option value="plumber">Plumber</option>
                    <option value="electrician">Electrician</option>
                    <option value="hvac">HVAC</option>
                </select>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea"></div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" class="text-input" id="textInput" placeholder="Type or speak...">
            <button class="btn btn-mic" id="micBtn" title="Voice input">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" y1="19" x2="12" y2="23"/>
                    <line x1="8" y1="23" x2="16" y2="23"/>
                </svg>
            </button>
            <button class="btn btn-primary" id="sendBtn">Send</button>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions" id="quickActions"></div>
    </div>

    <footer>
        <p id="footerText">Built with <a href="../">MayaLogic</a> ‚Äî Voice-first assistant for contractors</p>
    </footer>

    <script>
        // ============ Content Data ============
        var content = {
            en: {
                backLink: "‚Üê Back to MayaLogic",
                subtitle: "Interactive Voice Demo",
                tabPitch: "Pitch",
                tabInvoice: "Invoice Demo",
                tabQA: "Q&A",
                labelName: "Your Name",
                labelBusiness: "Business",
                labelTrade: "Trade",
                placeholder: "Type or speak...",
                send: "Send",
                footer: "Built with",
                footerSuffix: "‚Äî Voice-first assistant for contractors",
                trades: { general: "General", plumber: "Plumber", electrician: "Electrician", hvac: "HVAC" },
                pitches: {
                    general: "Running a trade business means juggling estimates, invoices, and material costs. Every minute on paperwork is a minute you're not billing. MayaLogic handles it all by voice‚Äîand runs locally first, so your data stays private and costs stay low.",
                    plumber: "Tired of paperwork eating your evenings? Every hour on invoices is an hour you're not billing. MayaLogic handles estimates, invoices, and pricing by voice. It runs on local AI first‚Äîfast, private, no per-query fees.",
                    electrician: "Losing time on NEC lookups and panel calculations? Those manual calculations slow every job. MayaLogic knows wire sizing, box fill, and code requirements‚Äîpowered by local AI for instant answers.",
                    hvac: "Spending too long on load calculations and equipment sizing? Manual math eats into your service calls. MayaLogic handles BTU calculations, refrigerant charges, and invoicing by voice."
                },
                greeting: "Hey {name}! I'm Maya, your voice-first business assistant. What would you like to explore today?",
                greetingDefault: "Hey! I'm Maya, your voice-first business assistant. What would you like to explore today?",
                invoiceIntro: "Let's create a sample invoice! Just tell me what work you did. For example: 'Replaced water heater, 3 hours labor.'",
                qaIntro: "Ask me anything about MayaLogic! I can explain features, pricing, or how the local-first AI works.",
                quickActions: ["Hear the pitch", "Create invoice", "What is MayaLogic?", "Pricing info", "How does local AI work?"],
                invoiceTitle: "INVOICE",
                invoiceNumber: "Invoice #",
                invoiceFrom: "From:",
                invoiceTo: "To: Customer",
                invoiceItem: "Item",
                invoiceQty: "Qty",
                invoicePrice: "Price",
                invoiceTotal: "Total",
                responses: {
                    pitch: "Here's why {business} needs MayaLogic: {pitch} Want me to speak this out loud?",
                    whatIs: "MayaLogic is a voice-first AI assistant built for contractors. You can create invoices, look up code requirements, calculate materials‚Äîall hands-free. It runs on local AI first, so it's fast and private.",
                    pricing: "MayaLogic uses a local-first approach. Most queries run on your device for free. Cloud AI is only used for complex tasks, keeping costs low. No monthly per-seat fees.",
                    localAI: "Local AI means the AI runs directly on your device. It's faster (no internet delay), private (data never leaves your device), and cheaper (no API costs). Cloud AI is a backup for complex queries.",
                    invoice: "I've created a sample invoice for you! In the real app, you'd say this naturally: 'Create invoice for Johnson, replaced water heater, 4 hours.' Maya handles the rest.",
                    default: "I can help you with pitches, invoices, or answer questions about MayaLogic. Try saying 'create an invoice' or 'what is MayaLogic?'"
                }
            },
            es: {
                backLink: "‚Üê Volver a MayaLogic",
                subtitle: "Demo Interactiva por Voz",
                tabPitch: "Pitch",
                tabInvoice: "Demo Factura",
                tabQA: "Preguntas",
                labelName: "Tu Nombre",
                labelBusiness: "Negocio",
                labelTrade: "Oficio",
                placeholder: "Escribe o habla...",
                send: "Enviar",
                footer: "Hecho con",
                footerSuffix: "‚Äî Asistente por voz para contratistas",
                trades: { general: "General", plumber: "Plomero", electrician: "Electricista", hvac: "HVAC" },
                pitches: {
                    general: "Manejar un negocio de oficios significa hacer malabares con cotizaciones, facturas y costos. Cada minuto en papeleo es un minuto que no cobras. MayaLogic maneja todo por voz‚Äîy corre localmente primero, as√≠ tus datos quedan privados.",
                    plumber: "¬øCansado del papeleo comi√©ndose tus noches? Cada hora en facturas es una hora sin cobrar. MayaLogic maneja cotizaciones, facturas y precios por voz. Corre en IA local‚Äîr√°pido, privado, sin cargos.",
                    electrician: "¬øPerdiendo tiempo en b√∫squedas de NEC y c√°lculos? Esos c√°lculos manuales atrasan cada trabajo. MayaLogic sabe calibre de cable y requisitos de c√≥digo‚Äîimpulsado por IA local.",
                    hvac: "¬øPasando mucho tiempo en c√°lculos de carga? Las matem√°ticas manuales se comen tus llamadas de servicio. MayaLogic maneja c√°lculos de BTU y facturaci√≥n por voz."
                },
                greeting: "¬°Hola {name}! Soy Maya, tu asistente de negocios por voz. ¬øQu√© te gustar√≠a explorar hoy?",
                greetingDefault: "¬°Hola! Soy Maya, tu asistente de negocios por voz. ¬øQu√© te gustar√≠a explorar hoy?",
                invoiceIntro: "¬°Vamos a crear una factura de ejemplo! Solo dime qu√© trabajo hiciste. Por ejemplo: 'Reemplac√© calentador de agua, 3 horas de mano de obra.'",
                qaIntro: "¬°Preg√∫ntame lo que quieras sobre MayaLogic! Puedo explicar funciones, precios, o c√≥mo funciona la IA local.",
                quickActions: ["Escuchar el pitch", "Crear factura", "¬øQu√© es MayaLogic?", "Info de precios", "¬øC√≥mo funciona IA local?"],
                invoiceTitle: "FACTURA",
                invoiceNumber: "Factura #",
                invoiceFrom: "De:",
                invoiceTo: "Para: Cliente",
                invoiceItem: "Concepto",
                invoiceQty: "Cant",
                invoicePrice: "Precio",
                invoiceTotal: "Total",
                responses: {
                    pitch: "Aqu√≠ est√° por qu√© {business} necesita MayaLogic: {pitch} ¬øQuieres que lo diga en voz alta?",
                    whatIs: "MayaLogic es un asistente de IA por voz para contratistas. Puedes crear facturas, buscar requisitos de c√≥digo, calcular materiales‚Äîtodo manos libres. Corre en IA local primero, as√≠ que es r√°pido y privado.",
                    pricing: "MayaLogic usa un enfoque local-primero. La mayor√≠a de consultas corren en tu dispositivo gratis. La IA en la nube solo se usa para tareas complejas, manteniendo costos bajos.",
                    localAI: "IA local significa que la IA corre directamente en tu dispositivo. Es m√°s r√°pida (sin delay de internet), privada (los datos nunca salen de tu dispositivo), y m√°s barata (sin costos de API).",
                    invoice: "¬°He creado una factura de ejemplo! En la app real, dir√≠as naturalmente: 'Crear factura para Johnson, reemplac√© calentador, 4 horas.' Maya hace el resto.",
                    default: "Puedo ayudarte con pitches, facturas, o responder preguntas sobre MayaLogic. Intenta decir 'crear factura' o '¬øqu√© es MayaLogic?'"
                }
            }
        };

        // ============ State ============
        var currentLang = localStorage.getItem('mayalogic_lang') || 'en';
        var currentMode = 'pitch';
        var isListening = false;
        var recognition = null;

        // ============ DOM Elements ============
        var chatArea = document.getElementById('chatArea');
        var textInput = document.getElementById('textInput');
        var micBtn = document.getElementById('micBtn');
        var sendBtn = document.getElementById('sendBtn');
        var langToggle = document.getElementById('langToggle');
        var quickActionsEl = document.getElementById('quickActions');

        // ============ Utility Functions ============
        function $(id) { return document.getElementById(id); }

        function createEl(tag, className, textContent) {
            var el = document.createElement(tag);
            if (className) el.className = className;
            if (textContent) el.textContent = textContent;
            return el;
        }

        function clearEl(el) {
            while (el.firstChild) el.removeChild(el.firstChild);
        }

        // ============ UI Updates ============
        function applyLanguage() {
            var c = content[currentLang];

            $('backLink').textContent = c.backLink;
            $('subtitleText').textContent = c.subtitle;
            $('tabPitch').textContent = c.tabPitch;
            $('tabInvoice').textContent = c.tabInvoice;
            $('tabQA').textContent = c.tabQA;
            $('labelName').textContent = c.labelName;
            $('labelBusiness').textContent = c.labelBusiness;
            $('labelTrade').textContent = c.labelTrade;
            textInput.placeholder = c.placeholder;
            sendBtn.textContent = c.send;
            langToggle.textContent = currentLang === 'es' ? 'ES' : 'EN';
            document.documentElement.lang = currentLang;

            // Update trade options
            var tradeSelect = $('userTrade');
            for (var i = 0; i < tradeSelect.options.length; i++) {
                var opt = tradeSelect.options[i];
                opt.textContent = c.trades[opt.value];
            }

            // Footer
            clearEl($('footerText'));
            $('footerText').appendChild(document.createTextNode(c.footer + ' '));
            var link = createEl('a', null, 'MayaLogic');
            link.href = '../';
            $('footerText').appendChild(link);
            $('footerText').appendChild(document.createTextNode(' ' + c.footerSuffix));

            updateQuickActions();
        }

        function updateQuickActions() {
            var c = content[currentLang];
            clearEl(quickActionsEl);

            c.quickActions.forEach(function(action) {
                var btn = createEl('button', 'quick-btn', action);
                btn.addEventListener('click', function() {
                    handleInput(action);
                });
                quickActionsEl.appendChild(btn);
            });
        }

        function addMessage(text, isUser) {
            var msg = createEl('div', 'message ' + (isUser ? 'user' : 'maya'));

            var avatar = createEl('div', 'avatar');
            avatar.textContent = isUser ? 'üë§' : 'ü§ñ';

            var bubble = createEl('div', 'bubble', text);

            msg.appendChild(avatar);
            msg.appendChild(bubble);
            chatArea.appendChild(msg);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function addInvoicePreview() {
            var c = content[currentLang];
            var userName = $('userName').value || 'Your Business';

            var preview = createEl('div', 'invoice-preview');

            // Header
            var header = createEl('div', 'invoice-header');
            var title = createEl('span', 'invoice-title', c.invoiceTitle);
            var num = createEl('span', null, c.invoiceNumber + '1001');
            header.appendChild(title);
            header.appendChild(num);
            preview.appendChild(header);

            // From/To
            var from = createEl('div', 'invoice-row');
            from.appendChild(createEl('span', null, c.invoiceFrom));
            from.appendChild(createEl('span', null, userName));
            preview.appendChild(from);

            var to = createEl('div', 'invoice-row');
            to.appendChild(createEl('span', null, c.invoiceTo));
            to.appendChild(createEl('span', null, ''));
            preview.appendChild(to);

            // Items
            var items = [
                { name: currentLang === 'es' ? 'Mano de obra (3 hrs)' : 'Labor (3 hrs)', price: '$225.00' },
                { name: currentLang === 'es' ? 'Calentador de agua' : 'Water heater', price: '$650.00' },
                { name: currentLang === 'es' ? 'Accesorios' : 'Fittings', price: '$45.00' }
            ];

            items.forEach(function(item) {
                var row = createEl('div', 'invoice-row');
                row.appendChild(createEl('span', null, item.name));
                row.appendChild(createEl('span', null, item.price));
                preview.appendChild(row);
            });

            // Total
            var total = createEl('div', 'invoice-row total');
            total.appendChild(createEl('span', null, c.invoiceTotal));
            total.appendChild(createEl('span', null, '$920.00'));
            preview.appendChild(total);

            // Wrap in message
            var msg = createEl('div', 'message maya');
            var avatar = createEl('div', 'avatar');
            avatar.textContent = 'ü§ñ';
            var bubble = createEl('div', 'bubble');
            bubble.appendChild(preview);
            msg.appendChild(avatar);
            msg.appendChild(bubble);
            chatArea.appendChild(msg);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ============ Speech Recognition ============
        function initSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                micBtn.style.display = 'none';
                return;
            }

            var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = currentLang === 'es' ? 'es-MX' : 'en-US';

            recognition.onresult = function(event) {
                var transcript = event.results[0][0].transcript;
                textInput.value = transcript;
                handleInput(transcript);
            };

            recognition.onend = function() {
                isListening = false;
                micBtn.classList.remove('listening');
            };

            recognition.onerror = function() {
                isListening = false;
                micBtn.classList.remove('listening');
            };
        }

        function toggleListening() {
            if (!recognition) return;

            if (isListening) {
                recognition.stop();
                isListening = false;
                micBtn.classList.remove('listening');
            } else {
                recognition.lang = currentLang === 'es' ? 'es-MX' : 'en-US';
                recognition.start();
                isListening = true;
                micBtn.classList.add('listening');
            }
        }

        // ============ Speech Synthesis ============
        function speak(text) {
            if (!('speechSynthesis' in window)) return;

            speechSynthesis.cancel();
            var utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === 'es' ? 'es-MX' : 'en-US';
            utterance.rate = 1.0;
            speechSynthesis.speak(utterance);
        }

        // ============ Input Handling ============
        function handleInput(text) {
            if (!text.trim()) return;

            addMessage(text, true);
            textInput.value = '';

            var c = content[currentLang];
            var trade = $('userTrade').value;
            var business = $('userBusiness').value || (currentLang === 'es' ? 'tu negocio' : 'your business');
            var response = '';

            var lowerText = text.toLowerCase();

            // Detect intent
            if (lowerText.includes('pitch') || lowerText.includes('escuchar') || lowerText.includes('hear')) {
                var pitch = c.pitches[trade];
                response = c.responses.pitch.replace('{business}', business).replace('{pitch}', pitch);
                setTimeout(function() { speak(pitch); }, 500);
            } else if (lowerText.includes('invoice') || lowerText.includes('factura') || lowerText.includes('crear')) {
                response = c.responses.invoice;
                setTimeout(addInvoicePreview, 300);
            } else if (lowerText.includes('what is') || lowerText.includes('qu√© es') || lowerText.includes('que es')) {
                response = c.responses.whatIs;
            } else if (lowerText.includes('pricing') || lowerText.includes('precio') || lowerText.includes('cost')) {
                response = c.responses.pricing;
            } else if (lowerText.includes('local ai') || lowerText.includes('ia local') || lowerText.includes('local-first')) {
                response = c.responses.localAI;
            } else {
                response = c.responses.default;
            }

            setTimeout(function() {
                addMessage(response, false);
            }, 400);
        }

        function setMode(mode) {
            currentMode = mode;

            document.querySelectorAll('.mode-tab').forEach(function(tab) {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });

            clearEl(chatArea);

            var c = content[currentLang];
            var name = $('userName').value;
            var greeting;

            if (mode === 'pitch') {
                greeting = name ? c.greeting.replace('{name}', name) : c.greetingDefault;
            } else if (mode === 'invoice') {
                greeting = c.invoiceIntro;
            } else {
                greeting = c.qaIntro;
            }

            addMessage(greeting, false);
        }

        // ============ Event Listeners ============
        langToggle.addEventListener('click', function() {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            localStorage.setItem('mayalogic_lang', currentLang);
            applyLanguage();
            if (recognition) recognition.lang = currentLang === 'es' ? 'es-MX' : 'en-US';
            setMode(currentMode);
        });

        document.querySelectorAll('.mode-tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                setMode(tab.dataset.mode);
            });
        });

        micBtn.addEventListener('click', toggleListening);

        sendBtn.addEventListener('click', function() {
            handleInput(textInput.value);
        });

        textInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') handleInput(textInput.value);
        });

        // ============ Initialize ============
        applyLanguage();
        initSpeechRecognition();
        setMode('pitch');
    </script>
</body>
</html>
